# 账户

`@orderly.network/hooks`提供以下 hook 来处理账户相关的逻辑：

- [`useAccount`](/)：获取当前账户信息及状态，并且可以通过该 hook 获取[`Account`](/)单例。
- [`useCollateral`](/) - 获取当前账户的余额
- [`useLeverage`](/) - 获取当前杠杆倍数

{/* 返回`@orderly.network/core`中 `Account`实例, `account`是一个单例, `Account`的相关信息请参考[这里](/)。 */}

## 账户状态

`Account`定义了以下几种状态：

```typescript
export enum AccountStatusEnum {
  NotConnected = 0,
  Connected = 1,
  NotSignedIn = 2,
  SignedIn = 3,
  DisabledTrading = 4,
  EnableTrading = 5,
}
```

### 获取账户状态

有两种方式可以获取账户状态，可以直接从 `useAccount` 返回值中取值，或者通过订阅事件的方式：

- 从`useAccount`返回的`state`中获取：

```typescript /state/
const { account, state, createOrderlyKey, createAccount } = useAccount();
```

`state`不仅包含了当前用户的状态，还包含了其他信息，类型定义如下：

```typescript
interface AccountState {
  status: AccountStatusEnum;
  checking: boolean;
  accountId?: string;
  userId?: string;
  address?: string;
}
```

- 监听`Account`实例的`change:status`事件，`account`是`Account`单例, 相关信息请参考[这里](/)。

```typescript /account/
import { useAccount } from "@orderly.network/hooks";
const { account, state, createOrderlyKey, createAccount } = useAccount();

const statusChangeHandler = (nextState: AccountState) => {
  // do something
};

useEffect(() => {
  account.on("change:status", statusChangeHandler);

  return () => {
    account.off("change:status", statusChangeHandler);
  };
}, []);
```

### 更新账户状态

`@orderly.network/hooks`本身并没有提供连接钱包的功能，**需要开发者自行处理钱包连接逻辑**。

待用户连接钱包后，将取得的`address`通过`setAddress`函数传递给`Account`实例，在调用`setAddress`的时候还需要传入另外三个参数：

- `provider` - 实现`EIP1193Provider`的 provider,
- `chain` - 当前链的信息，包含 id
- `wallet` - 钱包信息，包含钱包名称

`Account`的`setAddress`方法会检查传入的 address 所关联的账号和`OrderlyKey` 是否存在及是否有效，并更新`state`，如果`state`为`AccountStatusEnum.EnableTrading`，即表示已完成整个登录流程，可使用 Orderly 提供的所有服务。

```typescript /account/
import { useAccount } from "@orderly.network/hooks";
const { account, state } = useAccount();

//...连接钱包逻辑...

/**
 * setAddress会返回Promise<AccountStatusEnum>, 同时state也会更新
 */
const nextState = await account.setAddress("<address>", {
  provider: provider, // EIP1193Provider
  chain: {
    id: 1,
  },
  wallet: {
    name: "", // 钱包名称
  },
});
```

## 新建账户

{/* 调用`createAccount`函数` */}

```typescript /createAccount/
import { useAccount } from "@orderly.network/hooks";
const { account, state, createOrderlyKey, createAccount } = useAccount();

const res = await createAccount();
```

## OrderlyKey

创建 OrderlyKey, 可设置 OrderlyKey 的有效期，单位为天。

```typescript /createOrderlyKey/
import { useAccount } from "@orderly.network/hooks";
const { account, state, createOrderlyKey, createAccount } = useAccount();

const res = await createOrderlyKey(30);
```

OrderlyKey 创建成功后，将由配置的`KeyStore`保存，以备后续签名使用。

## 资产

请参考[资产](/assets)。
